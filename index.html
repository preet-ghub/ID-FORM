<!DOCTYPE html>
<html>
<head>
<title>ID Form</title>
<meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>
<body>
  <form id="myForm" enctype="multipart/form-data" method="post">
    
    
    <header><h1>ID CARD FORM</h1>
        <h3><i>session : 2025-2026</i></h3>
    </header>
    <main>
        <div>
            Name : <input type="text" name="name" placeholder="Your name" >
            <br><br>
            Father's Name : <input type="text" name="fatherName" placeholder="Your Father's Name" >
            <br><br>
            Mother's Name : <input type="text" name="motherName" placeholder="Your Mother's Name" >
            <br><br>
            Phone Number : <input type="tel" name="phone" placeholder="Your Phone no"  oninput="this.value = this.value.replace(/[^0-9]/g, '')" maxlength="10" required>
            <br><br>
            Guardian Number : <input type="tel" name="guardianPhone" placeholder="Your Guardian no" oninput="this.value = this.value.replace(/[^0-9]/g, '')" maxlength="10" required>
            <br><br>
            Class Name : <input type="text" name="admissionNo" placeholder="Your Class" >
            <br><br>
            Roll Number : <input type="text" name="rollNo" placeholder="Your Roll no" >
            <br><br>
            Section : <input type="text" name="section" placeholder="Your Section" maxlength="1" >
            <br><br>
            Email : <input type="email" name="email" placeholder="Your Email" >
            <br><br>
             Date Of Birth : <input type="date" name="dob" >
             <br><br>
             Address :<br>
             <textarea name="address" rows="5" cols="26"></textarea>
             <br><br>
             Upload Your Photo : <input type="file" id="photo" name="photoLink" accept="image/*" >
             <br>
             
             <button type="submit">Submit</button>
        </div>
    </main>
    <footer></footer>
      <p>&copy; 2025 All Rights Reserved | Designed by Preet</p>
    </footer>
    
  </form>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzthwWf8BfJQldDP9nj88-05Tnikx7l4E3JejdTa5Aqyjvj5F22FO3v0jMuNn3dUeEwTw/exec"; 
  
  const form = document.getElementById('myForm');
  const submitBtn = form.querySelector("button[type='submit']"); 
  let alreadySubmitted = false; 

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    
    if (alreadySubmitted) {
      return; 
    }
    alreadySubmitted = true;
    submitBtn.disabled = true;
    submitBtn.innerText = "Submitting...";

    const fd = new FormData(form);

    
    const dob = fd.get("dob");
    if (dob) {
      const [year, month, day] = dob.split("-");
      const formattedDOB = `${day}-${month}-${year}`;
      fd.set("dob", formattedDOB);
    }

    
    const fileInput = document.getElementById('photo');
    if (fileInput.files.length > 0) {
      const file = fileInput.files[0];
      const base64 = await fileToBase64(file);
      const clean = base64.split(',')[1] || base64;
      fd.set('photoLink', clean);
    } else {
      fd.delete('photoLink');
    }

    try {
      const res = await fetch(scriptURL, { method: 'POST', body: fd });
      if (res.ok) {
        window.location.href = "thankyou.html"; 
      } else {
        alert("Something went wrong. Please try again.");
        resetSubmit(); 
      }
    } catch (err) {
      alert("Network error. Please try again.");
      resetSubmit();
    }
  });

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = reject;
      reader.readAsDataURL(file);
    });
  }

  // âœ… helper to reset button if needed
  function resetSubmit() {
    alreadySubmitted = false;
    submitBtn.disabled = false;
    submitBtn.innerText = "Submit";
  }
</script>

  
  
   
</body>
</html>
